name: Deploy to Shinyapps
on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup R
        uses: r-lib/actions/setup-r@v2
        with:
          use-public-rspm: true

      - name: Install Dependencies and Deploy
        env:
          SHINY_NAME: ${{ secrets.SHINYAPPS_NAME }}
          SHINY_TOKEN: ${{ secrets.SHINYAPPS_TOKEN }}
          SHINY_SECRET: ${{ secrets.SHINYAPPS_SECRET }}
        run: |
          # התקנת החבילות הנדרשות
          Rscript -e 'install.packages(c("rsconnect", "shiny", "bslib", "thematic", "plotly", "DT", "dplyr", "rvest", "httr", "jsonlite", "class", "rpart", "stringr"))'
          
          # חיבור לחשבון וביצוע ה-Deployment
          Rscript -e "rsconnect::setAccountInfo(name='$SHINY_NAME', token='$SHINY_TOKEN', secret='$SHINY_SECRET')"
          Rscript -e "rsconnect::deployApp(appName='fraud-bot-ai')"
